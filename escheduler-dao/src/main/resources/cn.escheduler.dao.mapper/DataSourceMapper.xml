<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.escheduler.dao.mapper.DataSourceMapper">
    <select id="queryDataSourceByType" resultType="cn.escheduler.dao.entity.DataSource">
        select *
        from t_escheduler_datasource
        where type=#{type}
        <if test="userId != 0">
        and id in
          (select datasource_id
          from t_escheduler_relation_datasource_user
          where user_id=#{userId}
          union select id as datasource_id
                from t_escheduler_datasource
                where user_id=#{userId}
         )
        </if>

    </select>

    <select id="selectPaging" resultType="cn.escheduler.dao.entity.DataSource">
        select *
        from t_escheduler_datasource
        where 1 =1
        <if test="userId != 0">
         and id in
          (select datasource_id
            from t_escheduler_relation_datasource_user
            where user_id=#{userId}
            union select id as datasource_id
            from t_escheduler_datasource
            where user_id=#{userId}
            )
        </if>
        <if test="name != null and name != ''">
             and name like concat ('%', #{name}, '%')
         </if>
         order by update_time desc
    </select>
    <select id="queryDataSourceByName" resultType="cn.escheduler.dao.entity.DataSource">
        select *
        from t_escheduler_datasource
        where name=#{name}
    </select>
    <select id="queryAuthedDatasource" resultType="cn.escheduler.dao.entity.DataSource">
        select datasource.*
        from t_escheduler_datasource datasource, t_escheduler_relation_datasource_user rel
        where datasource.id = rel.datasource_id AND rel.user_id = #{userId}
    </select>
    <select id="queryDatasourceExceptUserId" resultType="cn.escheduler.dao.entity.DataSource">
        select *
        from t_escheduler_datasource
        where user_id <![CDATA[ <> ]]> #{userId}
    </select>
    <select id="listAllDataSourceByType" resultType="cn.escheduler.dao.entity.DataSource">
        select *
        from t_escheduler_datasource
        where type = #{type}
    </select>


</mapper>